version: '3.7'
services:
  frontend:
    # A simple container we can use to send requests from
    image: alpine:3.15
    # Keep it running so we can exec into it
    command: ["sleep", "infinity"]

  backend:
    # A simple web server to act as our backend service
    image: nginx:1.21
    # Nginx runs on port 80 by default
  
  envoy:
    # The envoy proxy
    image: envoyproxy/envoy:v1.20.0
    ports:
      # Expose the proxy's listener port to the host for optional direct testing
      - "8000:8000"
    volumes:
      # Mount the envoy configuration file
      - ./envoy.yaml:/etc/envoy/envoy.yaml
    # The command to start envoy with our config
    command: /usr/local/bin/envoy -c /etc/envoy/envoy.yaml
